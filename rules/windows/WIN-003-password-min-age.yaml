metadata:
  benchmark: CIS Microsoft Windows 10/11 Enterprise Benchmarks v1.12.0
  os: windows
  versions:
    - '10'
    - '11'

rule:
  id: WIN-003
  category: Account Policies
  subcategory: Password Policy
  description: Ensure 'Minimum password age' is set to '1 day'
  severity: medium

  audit:
    cis_reference: 1.1.3
    compliance_frameworks:
      - NIST SP 800-53
      - ISO 27001
      - PCI-DSS
    rationale: The Minimum password age policy setting determines the period of time
      (in days) that a password must be used before the user can change it. This prevents
      users from cycling through passwords to reuse an old password.
    impact: Users must wait the specified number of days before changing their password.
      This prevents users from immediately changing passwords multiple times to bypass
      password history.
  hardening_levels:
    basic:
      enabled: true
      value: 1
    moderate:
      enabled: true
      value: 1
    strict:
      enabled: true
      value: 1
  
check:
  type: command
  command: 'net accounts | Select-String "Minimum password age" | ForEach-Object { $_.ToString().Split(":")[1].Trim().Split(" ")[0] }'
  expected:
    type: number
    operator: '>='
    value: '{{hardening_value}}'
  timeout: 30
  retry: 2
  retry_delay: 5
  
remediation:
  type: command
  prerequisites:
    - admin_rights
  backup_before: true
  command: "net accounts /minpwage:{{hardening_value}}"
  requires_reboot: false
  timeout: 30
  verify_after: true
  verify_command: "$result = net accounts | Select-String 'Minimum password age' | ForEach-Object { $_.ToString().Split(':')[1].Trim().Split(' ')[0] }; $value = [int]$result; if ($value -ge {{hardening_value}}) { exit 0 } else { exit 1 }"
  
rollback:
  enabled: true
  backup_location: '{{backup_dir}}/WIN-003_{{timestamp}}.cfg'
  backup_command: 'secedit /export /cfg "{{backup_location}}" /areas SECURITYPOLICY
    /quiet

    '
  restore_command: 'secedit /configure /db secedit.sdb /cfg "{{backup_location}}"
    /areas SECURITYPOLICY /quiet

    '
  requires_reboot: false
  timeout: 30
  
logging:
  log_level: INFO
  log_category: password_policy
  audit_trail: true
  
reporting:
  report_section: Account Policies
  priority: medium
  remediation_complexity: low
  
tags:
  - password
  - policy
  - age
  - cis

notes: |
  Prevents password cycling. Must be less than WIN-002 (Maximum password age).
