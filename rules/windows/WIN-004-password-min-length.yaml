metadata:
  benchmark: CIS Microsoft Windows 10/11 Enterprise Benchmarks v1.12.0
  os: windows
  versions:
    - '10'
    - '11'

rule:
  id: WIN-004
  category: Account Policies
  subcategory: Password Policy
  description: Ensure 'Minimum password length' is set to '12 or more character(s)'
  severity: high

  audit:
    cis_reference: 1.1.4
    compliance_frameworks:
      - NIST SP 800-53
      - ISO 27001
      - PCI-DSS
      - HIPAA
    rationale: Longer passwords provide exponentially more complexity and are much
      more difficult to crack through brute force attacks. A minimum password length
      of 12 characters provides adequate protection against modern password cracking
      techniques.
    impact: Users will be required to create passwords with at least the specified
      number of characters. This may require education and support for users creating
      compliant passwords.
  hardening_levels:
    basic:
      enabled: true
      value: 12
    moderate:
      enabled: true
      value: 14
    strict:
      enabled: true
      value: 16
  
check:
  type: command
  command: 'net accounts | Select-String "Minimum password length:" | ForEach-Object { $_.ToString().Split(":")[1].Trim() }'
  expected:
    type: number
    operator: '>='
    value: '{{hardening_value}}'
  timeout: 30
  retry: 2
  retry_delay: 5
  
remediation:
  type: command
  prerequisites:
    - admin_rights
  backup_before: true
  command: "$tempFile = [System.IO.Path]::GetTempFileName(); '[System Access]' | Out-File -FilePath $tempFile -Encoding ASCII; 'MinimumPasswordLength = {{hardening_value}}' | Out-File -FilePath $tempFile -Encoding ASCII -Append; secedit /configure /db secedit.sdb /cfg $tempFile /areas SECURITYPOLICY /quiet; Remove-Item -Path $tempFile -Force"
  requires_reboot: false
  timeout: 30
  verify_after: true
  verify_command: "$tempFile = [System.IO.Path]::GetTempFileName(); secedit /export /cfg $tempFile /areas SECURITYPOLICY /quiet | Out-Null; Start-Sleep -Seconds 1; $content = Get-Content $tempFile; Remove-Item $tempFile -Force; $line = $content | Select-String 'MinimumPasswordLength'; if ($line) { $value = [int]($line.ToString().Split('=')[1].Trim()); if ($value -ge {{hardening_value}}) { exit 0 } else { exit 1 } } else { exit 1 }"
  
rollback:
  enabled: true
  backup_location: '{{backup_dir}}/WIN-004_{{timestamp}}.cfg'
  backup_command: 'secedit /export /cfg "{{backup_location}}" /areas SECURITYPOLICY
    /quiet

    '
  restore_command: 'secedit /configure /db secedit.sdb /cfg "{{backup_location}}"
    /areas SECURITYPOLICY /quiet

    '
  requires_reboot: false
  timeout: 30
  
logging:
  log_level: WARNING
  log_category: password_policy
  audit_trail: true
  
reporting:
  report_section: Account Policies
  priority: critical
  remediation_complexity: low
  
tags:
  - password
  - policy
  - length
  - cis
  - critical

notes: |
  Foundation security control. Works with WIN-005 (complexity). Consider passphrases for better security.
